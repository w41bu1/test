---
title: CVE-2025-58674 Analysis & POC
description: Security Vulnerability in WordPress Core.
date: 2025-10-11 17:18:00 +0700
categories: [Vulnerabilities, CVE Analyst]
tags: [analyst, core, xss]
image:
  path: assets/img/posts/2025-10-11-CVE-2025-58674/app.png
---

---

L·ªó h·ªïng **Stored Cross Site Scripting(XSS)** x·∫£y ra tr√™n WordPress Core tr∆∞·ªõc phi√™n b·∫£n `6.8.3`. Nguy√™n nh√¢n do sai x·ª≠ l√Ω ƒë·∫ßu v√†o khi sinh trang web ƒë·ªông, t√°c ƒë·ªông ƒë·∫øn ch·ª©c nƒÉng t·∫°o menu (`nav menus`)

* **CVE ID**: [CVE-2025-58674](https://www.cve.org/CVERecord?id=CVE-2025-58674)
* **Vulnerability Type**: Cross Site Scripting (XSS)
* **Affected Versions**: <= 6.8.2
* **Patched Versions**: 6.8.3
* **CVSS severity**: Low (5.9)
* **Required Privilege**: Author
* **Product**: [WordPressCore](https://wordpress.org/)

---

## Requirements

* **Local WordPress & Debugging**: [Local WordPress and Debugging](https://w41bu1.github.io/posts/wordpress-local-and-debugging/).
* **Wordpress Core Versions**: **v6.8.2** (vulnerable) v√† **v6.8.3** (patched).
* **Diff Tool** - [**Meld**](https://meldmerge.org/) ho·∫∑c b·∫•t k·ª≥ c√¥ng c·ª• so s√°nh (diff) n√†o ƒë·ªÉ ki·ªÉm tra v√† so s√°nh kh√°c bi·ªát gi·ªØa hai phi√™n b·∫£n.
* **Theme** - [**Astra**](https://wordpress.org/themes/astra/): Theme r·∫•t ph·ªï bi·∫øn v·ªõi ng∆∞·ªùi d√πng WordPress, h·ªó tr·ª£ t·∫°o **nav memu** nhanh ch√≥ng.

---

## Analysis

WordPress l√† ph·∫ßn m·ªÅm m√£ ngu·ªìn m·ªü, c√≥ kho l∆∞u tr·ªØ n·∫±m ·ªü github n√™n ta c√≥ th·ªÉ t√¨m ƒë·∫øn [commit](https://github.com/WordPress/WordPress/commit/e5caef19d3e842cc9c8c94621b223a9a696fb5b3) li√™n quan ƒë·∫øn s·ª± ki·ªán v√° l·ªó h·ªïng XSS ƒë·ªÉ quan s√°t s·ª± thay ƒë·ªïi, hi·ªÉu ƒë∆∞·ª£c l·ªó h·ªïng x·∫£y ra ·ªü ƒë√¢u.

### Patch diff

**B·∫£n l·ªói**:

```js
updateParentDropdown : function() {
    return this.each(function(){
        var menuItems = $( '#menu-to-edit li' ),
            parentDropdowns = $( '.edit-menu-item-parent' );

        $.each( parentDropdowns, function() {
            var parentDropdown = $( this ),
                $html = '',
                $selected = '',
                currentItemID = parentDropdown.closest( 'li.menu-item' ).find( '.menu-item-data-db-id' ).val(),
                currentparentID = parentDropdown.closest( 'li.menu-item' ).find( '.menu-item-data-parent-id' ).val(),
                currentItem = parentDropdown.closest( 'li.menu-item' ),
                currentMenuItemChild = currentItem.childMenuItems(),
                excludeMenuItem = [ currentItemID ];

            if ( currentMenuItemChild.length > 0 ) {
                $.each( currentMenuItemChild, function(){
                    var childItem = $(this),
                        childID = childItem.find( '.menu-item-data-db-id' ).val();

                    excludeMenuItem.push( childID );
                });
            }

            if ( currentparentID == 0 ) {
                $selected = 'selected';
            }

            $html += '<option ' + $selected + ' value="0">' + wp.i18n._x( 'No Parent', 'menu item without a parent in navigation menu' ) + '</option>';

            $.each( menuItems, function() {
                var menuItem = $(this),
                $selected = '',
                menuID = menuItem.find( '.menu-item-data-db-id' ).val(),
                menuTitle = menuItem.find( '.edit-menu-item-title' ).val();

                if ( ! excludeMenuItem.includes( menuID ) ) {
                    if ( currentparentID == menuID ) {
                        $selected = 'selected';
                    }
                    $html += '<option ' + $selected + ' value="' + menuID + '">' + menuTitle + '</option>';
                }
            });

            parentDropdown.html( $html );
        });
        
    });
},
```

Trong phi√™n b·∫£n l·ªói, gi√° tr·ªã `menuTitle` ƒë∆∞·ª£c ch√®n v√†o th·∫ª `<option>` v√† ƒë∆∞·ª£c hi·ªÉn th·ªã ra HTML b·∫±ng ph∆∞∆°ng th·ª©c [html()](https://api.jquery.com/html/) c·ªßa **jQuery** m√† kh√¥ng c√≥ b·∫•t k·ª≥ c∆° ch·∫ø ngƒÉn ch·∫∑n XSS n√†o. H√†m [html()](https://api.jquery.com/html/) d√πng ƒë·ªÉ thay th·∫ø n·ªôi dung HTML b√™n trong ph·∫ßn t·ª≠ hi·ªán t·∫°i, n√™n n·∫øu `menuTitle` ch·ª©a m√£ ƒë·ªôc th√¨ m√£ ƒë√≥ s·∫Ω ƒë∆∞·ª£c th·ª±c thi tr√™n tr√¨nh duy·ªát.

**B·∫£n v√°**:

```js
updateParentDropdown : function() {
    return this.each(function(){
        var menuItems = $( '#menu-to-edit li' ),
            parentDropdowns = $( '.edit-menu-item-parent' );

        $.each( parentDropdowns, function() {
            var parentDropdown = $( this ),
                currentItemID = parseInt( parentDropdown.closest( 'li.menu-item' ).find( '.menu-item-data-db-id' ).val() ),
                currentParentID = parseInt( parentDropdown.closest( 'li.menu-item' ).find( '.menu-item-data-parent-id' ).val() ),
                currentItem = parentDropdown.closest( 'li.menu-item' ),
                currentMenuItemChild = currentItem.childMenuItems(),
                excludeMenuItem =  /** @type {number[]} */ [ currentItemID ];

            parentDropdown.empty();

            if ( currentMenuItemChild.length > 0 ) {
                $.each( currentMenuItemChild, function(){
                    var childItem = $(this),
                        childID = parseInt( childItem.find( '.menu-item-data-db-id' ).val() );

                    excludeMenuItem.push( childID );
                });
            }

            parentDropdown.append(
                $( '<option>', {
                    value: '0',
                    selected: currentParentID === 0,
                    text: wp.i18n._x( 'No Parent', 'menu item without a parent in navigation menu' ),
                } )
            );

            $.each( menuItems, function() {
                var menuItem = $(this),
                menuID = parseInt( menuItem.find( '.menu-item-data-db-id' ).val() ),
                menuTitle = menuItem.find( '.edit-menu-item-title' ).val();

                if ( ! excludeMenuItem.includes( menuID ) ) {
                    parentDropdown.append(
                        $( '<option>', {
                            value: menuID.toString(),
                            selected: currentParentID === menuID,
                            text: menuTitle,
                        } )
                    );
                }
            });
        });
        
    });
},
```

B·∫£n v√° ƒë√£ kh·∫Øc ph·ª•c l·ªó h·ªïng b·∫±ng c√°ch ch·ªâ ƒë·ªãnh r√µ `menuTitle` ƒë∆∞·ª£c g√°n v√†o thu·ªôc t√≠nh `text` thay v√¨ n·ªôi dung HTML.
ƒêi·ªÅu n√†y ƒë·∫£m b·∫£o gi√° tr·ªã c·ªßa `menuTitle` ƒë∆∞·ª£c x·ª≠ l√Ω nh∆∞ vƒÉn b·∫£n thu·∫ßn t√∫y, kh√¥ng th·ªÉ ch·ª©a ho·∫∑c th·ª±c thi m√£ JavaScript ƒë·ªôc h·∫°i.
Nh·ªù ƒë√≥, d·ªØ li·ªáu ƒë∆∞·ª£c th√™m v√†o th·∫ª `<option>` ho√†n to√†n an to√†n v√† lo·∫°i b·ªè kh·∫£ nƒÉng t·∫•n c√¥ng XSS th√¥ng qua gi√° tr·ªã `menuTitle`.

![Diff](assets/img/posts/2025-10-11-CVE-2025-58674/dif.png)

---

### Vulnerable code 
Inpsect code tr√™n tr√¨nh duy·ªát ta th·∫•y `menuItems = #menu-to-edit li` l√† m·∫£ng c√°c th·∫ª `<li>` thu·ªôc th·∫ª `<ul>` c√≥ `id=menu-to-edit`

![View Source](assets/img/posts/2025-10-11-CVE-2025-58674/viewsource.png)

H√†m `updateParentDropdown` s·∫Ω duy·ªát c√°c th·∫ª `<li>` l·∫•y value c·ªßa `<input>` c√≥ class `edit-menu-item-title`, g√°n gi√° tr·ªã ƒë√≥ cho `menuTitle` trong th·∫ª `<option>` v√† hi·ªÉn th·ªã ra HTML.

![View Source](assets/img/posts/2025-10-11-CVE-2025-58674/viewsource1.png)

**Tr√™n UI**:

![On UI](assets/img/posts/2025-10-11-CVE-2025-58674/UIlist.png)

Trong [commit](https://github.com/WordPress/WordPress/commit/e5caef19d3e842cc9c8c94621b223a9a696fb5b3) c√≥ m·ªôt s·ª≠a ƒë·ªïi t∆∞·ªüng ch·ª´ng l√† h·ªØu √≠ch, nh∆∞ng ch·∫£ c√≥ √≠ch cho qu√° tr√¨nh ph√¢n t√≠ch.

![HTML encode](assets/img/posts/2025-10-11-CVE-2025-58674/htmlett.png)

T√¥i ƒë√£ s·ª≠ d·ª•ng `//` ƒë·ªÉ comment t·∫•t c·∫£ c√°c d√≤ng li√™n quan ƒë·∫øn `html_entity_decode` c·ªßa `origin_title` nh∆∞ng v·∫´n khai th√°c ƒë∆∞·ª£c. Tr∆∞·ªõc ƒë√≥ t√¥i ƒë√£ ƒë·∫∑t debug ƒë·∫øn c√°c v·ªã tr√≠ n√†y nh∆∞ng kh√¥ng c√≥ g√¨ x·∫£y ra.

Ngo√†i vi·ªác s·ª≠ d·ª•ng comment, t√¥i ƒë√£ ch·ªçn menu ch·ª©a XSS payload v√† click <kbd>Add to Menu</kbd>, b·∫Øt request b·∫±ng **BurpSuite** ƒë·ªÉ xem gi√° tr·ªã ƒë∆∞·ª£c add c√≥ ƒë∆∞·ª£c html entity encode kh√¥ng.

```html
<span class="add-to-menu">
    <input type="submit" class="button submit-add-to-menu right" value="Add to Menu" name="add-post-type-menu-item" id="submit-posttype-post">
    <span class="spinner"></span>
</span>
```

![HTML encode](assets/img/posts/2025-10-11-CVE-2025-58674/htmlett1.png)

`menu-item-title` l√† gi√° tr·ªã l·∫•y th·∫ª input c√≥ name `menu-item[-5][menu-item-title]` t·ª´ `post-title` ƒë∆∞·ª£c **check** ƒë·ªÉ th√™m v√†o body c·ªßa request

```html
<input type="hidden" class="menu-item-title" name="menu-item[-5][menu-item-title]" value="<script>alert(document.domain)</script>">
```

C√≥ 1 ƒëi·ªÅu th√∫ v·ªã ·ªü ƒë√¢y, tr√¨nh duy·ªát l·∫•y gi√° tr·ªã ƒë√£ decode html entity ƒë·ªÉ th√™m v√†o request, bi·∫øt gi√° tr·ªã t·ª´ server tr∆∞·ªõc khi echo ra HTML ƒë√£ ƒë∆∞·ª£c encode

![HTML encode](assets/img/posts/2025-10-11-CVE-2025-58674/htmlett2.png)

üëâ Browser ƒë√£ decode html entity tr∆∞·ªõc khi hi·ªÉn th·ªã ra HTML.

Tr√™n DOM, sau khi click <kbd>Add to Menu</kbd> => `attachTabsPanelListeners` ƒë∆∞·ª£c g·ªçi v√† th√™m gi√° tr·ªã v·ª´a **selected** v√†o bottom c·ªßa menu item.

![Add item to bottom](assets/img/posts/2025-10-11-CVE-2025-58674/addbottom.png)

üëâ `edit-menu-item-title` c√≥ gi√° tr·ªã ch·ª©a XSS payload. H√†m `updateParentDropdown` s·∫Ω l·∫•y n√≥ g√°n cho th·∫ª `<option>` => XSS x·∫£y ra

### Sources & Sinks

* **Source**: `post-title` ti√™u ƒë·ªÅ c·ªßa post
* **Sink**: `parentDropdown.html( $html )` c√≥ th·ªÉ ch·ª©a HTML ƒë·ªôc h·∫°i

```php
$html += '<option ' + $selected + ' value="' + menuID + '">' + menuTitle + '</option>';
```

---

## Exploit
### Proof of Concept (PoC)

- S·ª≠ d·ª•ng t√†i kho·∫£n author, t·∫°o post c√≥ title ch·ª©a XSS payload
- Admin truy c·∫≠p endpoint `wp-admin/nav-menus.php` v√† th·ª±c hi·ªán add menus t·ª´ post v·ª´a t·∫°o
- S·ª± ki·ªán Javascript ƒë∆∞·ª£c k√≠ch ho·∫°t

![Xss](assets/img/posts/2025-10-11-CVE-2025-58674/xss.png)

> Th·∫ª `<script>` n·∫±m trong `<option>` thu·ªôc `<select>` c√≥ th·ªÉ th·ª±c thi ƒë∆∞·ª£c nh∆∞ng c√°c th·∫ª kh√°c th√¨ kh√¥ng, ch·ªâ tr·∫£ v·ªÅ text ch·ª©a trong ƒë√≥.
{: .prompt-info }

- Khi browser parse chu·ªói HTML, `<script>` kh√¥ng n·∫±m trong flow `<option>` th·ª±c s·ª± m√† parser ‚Äúnh·∫•c‚Äù script ra kh·ªèi `<option>` v√† ƒë∆∞a v√†o DOM tree.
```html
<select name="" id="">
    <option value="">abc</option>
    <option value=""><script>alert(1)</script></option>
</select>
```

- V√¨ th·∫ø, script th·ª±c thi ngay, c√≤n `<option>` v·∫´n t·ªìn t·∫°i, nh∆∞ng n·ªôi dung `<option>` tr·ªëng ho·∫∑c hi·ªÉn th·ªã text r·ªóng.

![Inspect](assets/img/posts/2025-10-11-CVE-2025-58674/inspect1.png)

- ƒê·ªëi v·ªõi c√°c th·∫ª kh√°c 
```html
<select name="" id="">
	<option value="">abc</option>
	<option value=""><b>abd</b></option>
</select>
```
    - Browser tu√¢n th·ªß spec: `<option>` ch·ªâ ch·ª©a text-only.
    - Khi parse `<b>` ho·∫∑c `<img>` trong `<option>`:
        - `<b>` b·ªã coi l√† text => m·∫•t tag, ch·ªâ hi·ªÉn th·ªã abd nh∆∞ text.
        - `<img>` b·ªã lo·∫°i b·ªè ho√†n to√†n.

- Kh√¥ng c√≥ g√¨ ƒë∆∞·ª£c th·ª±c thi, `<option>` hi·ªÉn th·ªã b√¨nh th∆∞·ªùng.

![Inspect](assets/img/posts/2025-10-11-CVE-2025-58674/inspect2.png)

---

## Conclusion

CVE-2025-58674 cho th·∫•y r·ªßi ro khi ch√®n d·ªØ li·ªáu ng∆∞·ªùi d√πng tr·ª±c ti·∫øp v√†o HTML b·∫±ng `html()` ho·∫∑c `innerHTML`. `<script>` trong `<option>` ƒë∆∞·ª£c parser t√°ch ra v√† th·ª±c thi, trong khi c√°c th·∫ª kh√°c b·ªã b·ªè ho·∫∑c coi l√† text. B·∫£n v√° s·ª≠ d·ª•ng thu·ªôc t√≠nh `text` ƒë·ªÉ ƒë·∫£m b·∫£o an to√†n, lo·∫°i b·ªè XSS.

---

## Key takeaways

* Kh√¥ng n·ªëi chu·ªói HTML t·ª´ d·ªØ li·ªáu user r·ªìi ch√®n b·∫±ng `html()`/`innerHTML`.
* D√πng API t·∫°o element an to√†n (`option.text`, `document.createElement`).
* Lu√¥n escape/sanitize d·ªØ li·ªáu ·ªü c·∫£ server v√† client.
* Hi·ªÉu h√†nh vi parser: `<script>` c√≥ th·ªÉ tho√°t kh·ªèi container inert.

---

## References

[Cross-site scripting (XSS) cheat sheet ‚Äî PortSwigger](https://portswigger.net/web-security/cross-site-scripting/cheat-sheet)

[ WordPress Core <= 6.8.2 is vulnerable to Cross Site Scripting (XSS) ](https://patchstack.com/database/wordpress/wordpress/wordpress/vulnerability/wordpress-wordpress-wordpress-6-8-2-cross-site-scripting-xss-vulnerability)

---
